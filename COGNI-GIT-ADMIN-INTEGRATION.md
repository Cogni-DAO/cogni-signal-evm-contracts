# CogniSignal Integration Guide

Complete integration documentation for [cogni-git-admin](https://github.com/Cogni-DAO/cogni-git-admin/blob/main/AGENTS.md).

## Status: Proof of Concept Working ✅

End-to-end integration functioning with single wallet execution for POC testing.

## Contract Details
- **Address:** `0x8F26cF7b9ca6790385E255E8aB63acc35e7b9FB1`
- **Network:** Sepolia (Chain ID: 11155111) 
- **DAO:** `0xa38d03Ea38c45C1B6a37472d8Df78a47C1A31EB5`
- **Status:** ✅ [Verified on Etherscan](https://sepolia.etherscan.io/address/0x8f26cf7b9ca6790385e255e8ab63acc35e7b9fb1)

## CogniAction Event

```solidity
event CogniAction(
    address indexed dao,      // DAO address (0xa38d03Ea38c45C1B6a37472d8Df78a47C1A31EB5)
    uint256 indexed chainId,  // Chain ID (11155111 for Sepolia) 
    string repo,              // GitHub repo (e.g. "owner/repo")
    string action,            // Action type (e.g. "PR_APPROVE")
    string target,            // Target (e.g. "pull_request")
    uint256 pr,               // Pull request number
    bytes32 commit,           // Git commit hash
    bytes extra,              // ABI-encoded: (nonce, deadline, paramsJson)
    address indexed executor  // Caller address (same as dao)
);
```

**Topic Hash:** `0xfd9a8ea95d56c7bd709823c6589c50386a2e5833892ef0e93c7bf63fee30bde1`

## Implementation

The [cogni-git-admin](https://github.com/Cogni-DAO/cogni-git-admin) processes these events via:

1. **Webhook Reception** - Alchemy webhooks to `/api/v1/webhooks/onchain/cogni-signal`
2. **Transaction Parsing** - Extract CogniAction events from transaction logs
3. **Validation** - Verify chain ID and DAO address match expected values
4. **GitHub Execution** - Convert governance signals to GitHub operations

## Deployment & Integration

### Quick Start

1. **Deploy Stack**
   ```bash
   make dao-setup  # Deploys ERC20 → DAO → CogniSignal
   ```

2. **Copy Generated Variables**
   - Console output displays all required variables
   - Also saved to `.env.{TOKEN_SYMBOL}` file
   - Paste into cogni-git-admin `.env` file

3. **Configure Webhook**
   - Set up Alchemy webhook monitoring `SIGNAL_CONTRACT`
   - Point to: `https://your-domain/api/v1/webhooks/onchain/cogni-signal`

### Environment Variables

Generated by `make dao-setup`:

```bash
# Required
WALLET_PRIVATE_KEY=0x...          # Execution wallet
EVM_RPC_URL=https://...           # Sepolia RPC
SIGNAL_CONTRACT=0x...             # CogniSignal address
DAO_ADDRESS=0x...                 # DAO contract
CHAIN_ID=11155111                 # Sepolia

# Optional (Aragon deployments)
ARAGON_ADMIN_PLUGIN_CONTRACT=0x...  # Admin plugin
```

### Processing Flow

1. **DAO Execution** → Calls `signal()` on CogniSignal
2. **Event Emission** → `CogniAction` event with governance data
3. **Webhook Reception** → Alchemy forwards to cogni-git-admin
4. **Validation** → Verify chain ID and DAO address
5. **GitHub Action** → Execute approved operation

## Security & Validation

- `onlyDAO` modifier restricts contract access
- Chain ID and DAO address validated on every event
- Contract verified on Etherscan for transparency

## Limitations & Production Requirements

### Current POC Limitations
- Single wallet execution (not multi-signature governance)
- Manual configuration required
- Simplified permissions for development

### Production Checklist
- [ ] Multi-signature governance implementation
- [ ] Comprehensive permission management
- [ ] Smart contract audit
- [ ] Monitoring and alerting infrastructure
- [ ] Emergency pause mechanisms
- [ ] Rate limiting and spam protection